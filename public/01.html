<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script>
      if(document.referrer.slice(0,27) != "http://www.sevenfridayz.com"){
        window.location.href="http://www.baidu.com"
      }
    </script>
    <style>
      *{
        margin:0;
        padding:0;
      }
      .full{
        width:100%;
      }
    </style>
  </head>
  <body onload="showImage(),showCode()">
    <img class="full" src="./image/first.png">
    <a id="aMoban"></a>
    <a id="aWid"></a>
    <a id="aCode"></a>
    <div id="d1"></div>
    <button id="b1">add watch</button>
    <script>
      // 1.........................................
      function showImage(){
        // 1.
        var xhr = new XMLHttpRequest()
        // 2.
        xhr.onreadystatechange =()=>{
          if(xhr.readyState==4 && xhr.status==200){
            var result = xhr.responseText
            console.log("这是路由mypro/showImage显示的数据:"+result)
            
            d1.innerHTML = `<img src="./image/${result.replace("_","-")}.png">`
            aWid.innerHTML = result.replace("_","/")
            aMoban.innerHTML = result.replace("_","/")+"  SF-"

          }
        }
        // 3.
        var url = "/mypro/showImage"+window.location.search
        xhr.open("get",url,true)
        // 4.
        xhr.send(null)
      }
      // 2...................................................
      function showCode(){
        // 1.
        var xhr = new XMLHttpRequest()
        // 2.
        xhr.onreadystatechange= ()=>{
          if(xhr.readyState==4 && xhr.status==200){
            var result = xhr.responseText
            console.log(result)
            aCode.innerHTML += "-" + result.replace("_","/")
          }
        }
        // 3.
        var url = "/mypro/showCode"+window.location.search
        xhr.open("get",url,true)
        // 4.
        xhr.send(null)
      }

      // 3.......................................
      function regLoginPage(){
        // http://127.0.0.1:9000/check.html?n=n&wid=M2-02&code=-A007
        window.location.href=`${window.location.origin}/login.html?n=n&wid=${aWid.innerHTML.replace("/","-")}&code=${aCode.innerHTML.replace("-","")}`
      }
    </script>
    <script>
      // 判断图片是否存在,则去百度吧
      setTimeout(() => {
        function isHasImg(pathImg) {
          var ImgObj=new Image()
          ImgObj.src= pathImg
          console.log(pathImg)
          console.log(ImgObj.fileSize)
          console.log(ImgObj.width,ImgObj.height)
          if(ImgObj.fileSize > 0 || (ImgObj.width > 0 && ImgObj.height > 0)){
            return true
          } else {
            return false
          }
        }

        if(isHasImg(d1.innerHTML.slice(10,d1.innerHTML.length-2))){
              console.log("verygood")
              window.document.getElementById("b1").innerHTML = `<button id="b1" onclick="regLoginPage()">add watch</button>`
            }else{
              window.location.href="http://www.baidu.com"
              console.log("验证图片不通过")
        }
      }, 3000);
    </script>
  </body>
</html>
