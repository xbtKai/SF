<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script>
      if(document.referrer.slice(0,27) != "http://www.sevenfridayz.com"){
        window.location.href="http://www.baidu.com"
      }
    </script>
    <style>
      *{
        margin:0;
        padding:0;
      }
      .full{
        width:100%;
      }
    </style>
  </head>
  <body onload="showImage(),showCode()">
    <img class="full" src="./image/first.png">
    <a id="aMoban"></a>
    <a id="aWid"></a>
    <a id="aCode"></a>
    <div id="d1"></div>
    <button onclick="regLoginPage()">add watch</button>
    <script>
      var ImgObj=new Image()
      // 1.........................................
      function showImage(){
        // 1.
        var xhr = new XMLHttpRequest()
        // 2.
        xhr.onreadystatechange =()=>{
          if(xhr.readyState==4 && xhr.status==200){
            var result = xhr.responseText
            console.log("这是路由mypro/showImage显示的数据:"+result)

            // 判断图片是否存在,则去百度吧
            function isHasImg(pathImg){
              ImgObj.onload = function () {
                console.log("img is loaded")
              }; 
              ImgObj.src= pathImg
              console.log(ImgObj.fileSize)
              if(ImgObj.fileSize > 0 || (ImgObj.width > 0 && ImgObj.height > 0)){
                return true;
              } else {
                return false;
              }
            }

            d1.innerHTML = `<img src="./image/${result.replace("_","-")}.png">`
            aWid.innerHTML = result.replace("_","/")
            aMoban.innerHTML = result.replace("_","/")+"  SF-"
            if(isHasImg(`./image/${result.replace("_","-")}.png`)){
              console.log("verygood")
            }else{
              window.location.href="http://www.baidu.com"
            }
          }
        }
        // 3.
        var url = "/mypro/showImage"+window.location.search
        xhr.open("get",url,true)
        // 4.
        xhr.send(null)
      }
      // 2...................................................
      function showCode(){
        // 1.
        var xhr = new XMLHttpRequest()
        // 2.
        xhr.onreadystatechange= ()=>{
          if(xhr.readyState==4 && xhr.status==200){
            var result = xhr.responseText
            console.log(result)
            aCode.innerHTML += "-" + result.replace("_","/")
          }
        }
        // 3.
        var url = "/mypro/showCode"+window.location.search
        xhr.open("get",url,true)
        // 4.
        xhr.send(null)
      }

      // 3.......................................
      function regLoginPage(){
        // http://127.0.0.1:9000/check.html?n=n&wid=M2-02&code=-A007
        window.location.href=`${window.location.origin}/login.html?n=n&wid=${aWid.innerHTML.replace("/","-")}&code=${aCode.innerHTML.replace("-","")}`
      }
    </script>
  </body>
</html>
